var JS=(typeof this.JS==='undefined')?{}:this.JS;(function(a){var b=(typeof this.global==='object')?this.global:this,c=(typeof exports==='object');if(c){exports.JS=exports;JS=exports}else{b.JS=JS}a(b,JS)})(function(o,n){'use strict';var e={ENV:o};e.END_WITHOUT_DOT=/([^\.])$/;e.array=function(a){var b=[],c=a.length;while(c--)b[c]=a[c];return b};e.bind=function(a,b){return function(){return a.apply(b,arguments)}};e.Date=e.ENV.Date;e.extend=function(a,b,c){if(!a||!b)return a;for(var d in b){if(a[d]===b[d])continue;if(c===false&&a.hasOwnProperty(d))continue;a[d]=b[d]}return a};e.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;while(c--){if(a[c]===b)return c}return-1};e.isType=function(a,b){if(typeof b==='string')return typeof a===b;if(a===null||a===undefined)return false;return(typeof b==='function'&&a instanceof b)||(a.isA&&a.isA(b))||a.constructor===b};e.makeBridge=function(a){var b=function(){};b.prototype=a.prototype;return new b()};e.makeClass=function(a){a=a||Object;var b=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this};b.prototype=e.makeBridge(a);b.superclass=a;b.subclasses=[];if(a.subclasses)a.subclasses.push(b);return b};e.match=function(a,b){if(b===undefined)return false;return typeof a.test==='function'?a.test(b):a.match(b)};e.Method=e.makeClass();e.extend(e.Method.prototype,{initialize:function(a,b,c){this.module=a;this.name=b;this.callable=c;this._1={};if(typeof c!=='function')return;this.arity=c.length;var d=c.toString().match(/\b[a-z\_\$][a-z0-9\_\$]*\b/ig),f=d.length;while(f--)this._1[d[f]]=true},setName:function(a){this.callable.displayName=this.displayName=a},contains:function(a){return this._1.hasOwnProperty(a)},call:function(){return this.callable.call.apply(this.callable,arguments)},apply:function(a,b){return this.callable.apply(a,b)},compile:function(i){var j=this,k=j.module.__trace__||i.__trace__,l=j.callable,t=j._1,q=e.Method._3,r=q.length,m=[],p;while(r--){p=q[r];if(t[p.name])m.push(p)}if(m.length===0&&!k)return l;var s=function(){var a=m.length,b=a,c={},d,f,g;while(b--){d=m[b];f=this[d.name];if(f&&!f.__kwd__)continue;c[d.name]={_2:f,_4:this.hasOwnProperty(d.name)};g=d.filter(j,i,this,arguments);g.__kwd__=true;this[d.name]=g}var h=l.apply(this,arguments),b=a;while(b--){d=m[b];if(!c[d.name])continue;if(c[d.name]._4)this[d.name]=c[d.name]._2;else delete this[d.name]}return h};var u=k&&(n.StackTrace||require('./stack_trace').StackTrace);if(k)return u.wrap(s,j,i);return s},toString:function(){var a=this.displayName||(this.module.toString()+'#'+this.name);return'#<Method:'+a+'>'}});e.Method.create=function(a,b,c){if(c&&c.__inc__&&c.__fns__)return c;var d=(typeof c!=='function')?c:new this(a,b,c);this.notify(d);return d};e.Method.compile=function(a,b){return a&&a.compile?a.compile(b):a};e.Method.__listeners__=[];e.Method.added=function(a,b){this.__listeners__.push([a,b])};e.Method.notify=function(a){var b=this.__listeners__,c=b.length,d;while(c--){d=b[c];d[0].call(d[1],a)}};e.Method._3=[];e.Method.keyword=function(a,b){this._3.push({name:a,filter:b})};e.Method.tracing=function(d,f,g){var h=n.require?n:require('./loader');h.require('JS.StackTrace',function(a){var b=a.logger,c=b.active;d=[].concat(d);this.trace(d);b.active=true;f.call(g);this.untrace(d);b.active=c},this)};e.Method.trace=function(a){var b=a.length;while(b--){a[b].__trace__=true;a[b].resolve()}};e.Method.untrace=function(a){var b=a.length;while(b--){a[b].__trace__=false;a[b].resolve()}};e.Module=e.makeClass();e.Module.__queue__=[];e.extend(e.Module.prototype,{initialize:function(a,b,c){if(typeof a!=='string'){c=arguments[1];b=arguments[0];a=undefined}c=c||{};this.__inc__=[];this.__dep__=[];this.__fns__={};this.__tgt__=c._5;this.__anc__=null;this.__mct__={};this.setName(a);this.include(b,{_0:false});if(e.Module.__queue__)e.Module.__queue__.push(this)},setName:function(a){this.displayName=a||'';for(var b in this.__fns__)this.__name__(b);if(a&&this.__meta__)this.__meta__.setName(a+'.')},__name__:function(a){if(!this.displayName)return;var b=this.__fns__[a];if(!b)return;a=this.displayName.replace(e.END_WITHOUT_DOT,'$1#')+a;if(typeof b.setName==='function')return b.setName(a);if(typeof b==='function')b.displayName=a},define:function(a,b,c){var d=e.Method.create(this,a,b),f=(c||{})._0;this.__fns__[a]=d;this.__name__(a);if(f!==false)this.resolve()},include:function(a,b){if(!a)return this;var b=b||{},c=b._0!==false,d=a.extend,f=a.include,g,h,i,j,k,l;if(a.__fns__&&a.__inc__){this.__inc__.push(a);if((a.__dep__||{}).push)a.__dep__.push(this);if(g=b._6){if(typeof a.extended==='function')a.extended(g)}else{if(typeof a.included==='function')a.included(this)}}else{if(this.shouldIgnore('extend',d)){j=[].concat(d);for(k=0,l=j.length;k<l;k++)this.extend(j[k])}if(this.shouldIgnore('include',f)){j=[].concat(f);for(k=0,l=j.length;k<l;k++)this.include(j[k],{_0:false})}for(h in a){if(!a.hasOwnProperty(h))continue;i=a[h];if(this.shouldIgnore(h,i))continue;this.define(h,i,{_0:false})}if(a.hasOwnProperty('toString'))this.define('toString',a.toString,{_0:false})}if(c)this.resolve();return this},alias:function(a){for(var b in a){if(!a.hasOwnProperty(b))continue;this.define(b,this.instanceMethod(a[b]),{_0:false})}this.resolve()},resolve:function(a){var a=a||this,b=a.__tgt__,c=this.__inc__,d=this.__fns__,f,g,h,i;if(a===this){this.__anc__=null;this.__mct__={};f=this.__dep__.length;while(f--)this.__dep__[f].resolve()}if(!b)return;for(f=0,g=c.length;f<g;f++)c[f].resolve(a);for(h in d){i=e.Method.compile(d[h],a);if(b[h]!==i)b[h]=i}if(d.hasOwnProperty('toString'))b.toString=e.Method.compile(d.toString,a)},shouldIgnore:function(a,b){return(a==='extend'||a==='include')&&(typeof b!=='function'||(b.__fns__&&b.__inc__))},ancestors:function(a){var b=!a,a=a||[],c=this.__inc__;if(b&&this.__anc__)return this.__anc__.slice();for(var d=0,f=c.length;d<f;d++)c[d].ancestors(a);if(e.indexOf(a,this)<0)a.push(this);if(b)this.__anc__=a.slice();return a},lookup:function(a){var b=this.__mct__[a];if(b&&b.slice)return b.slice();var c=this.ancestors(),d=[],f;for(var g=0,h=c.length;g<h;g++){f=c[g].__fns__;if(f.hasOwnProperty(a))d.push(f[a])}this.__mct__[a]=d.slice();return d},includes:function(a){if(a===this)return true;var b=this.__inc__;for(var c=0,d=b.length;c<d;c++){if(b[c].includes(a))return true}return false},instanceMethod:function(a){return this.lookup(a).pop()},instanceMethods:function(a,b){var c=b||[],d=this.__fns__,f;for(f in d){if(!e.isType(this.__fns__[f],e.Method))continue;if(e.indexOf(c,f)>=0)continue;c.push(f)}if(a!==false){var g=this.ancestors(),h=g.length;while(h--)g[h].instanceMethods(false,c)}return c},match:function(a){return a&&a.isA&&a.isA(this)},toString:function(){return this.displayName}});e.Kernel=new e.Module('Kernel',{__eigen__:function(){if(this.__meta__)return this.__meta__;var a=this.toString()+'.';this.__meta__=new e.Module(a,null,{_5:this});return this.__meta__.include(this.klass,{_0:false})},equals:function(a){return this===a},extend:function(a,b){var c=(b||{})._0;this.__eigen__().include(a,{_6:this,_0:c});return this},hash:function(){return e.Kernel.hashFor(this)},isA:function(a){return(typeof a==='function'&&this instanceof a)||this.__eigen__().includes(a)},method:function(a){var b=this.__mct__=this.__mct__||{},c=b[a],d=this[a];if(typeof d!=='function')return d;if(c&&d===c._2)return c._7;var f=e.bind(d,this);b[a]={_2:d,_7:f};return f},methods:function(){return this.__eigen__().instanceMethods()},tap:function(a,b){a.call(b||null,this);return this},toString:function(){if(this.displayName)return this.displayName;var a=this.klass.displayName||this.klass.toString();return'#<'+a+':'+this.hash()+'>'}});(function(){var b=1;e.Kernel.hashFor=function(a){if(a.__hash__!==undefined)return a.__hash__;a.__hash__=(new e.Date().getTime()+b).toString(16);b+=1;return a.__hash__}})();e.Class=e.makeClass(e.Module);e.extend(e.Class.prototype,{initialize:function(a,b,c,d){if(typeof a!=='string'){d=arguments[2];c=arguments[1];b=arguments[0];a=undefined}if(typeof b!=='function'){d=c;c=b;b=Object}e.Module.prototype.initialize.call(this,a);d=d||{};var f=e.makeClass(b);e.extend(f,this);f.prototype.constructor=f.prototype.klass=f;f.__eigen__().include(b.__meta__,{_0:d._0});f.setName(a);f.__tgt__=f.prototype;var g=(b===Object)?{}:(b.__fns__?b:new e.Module(b.prototype,{_0:false}));f.include(e.Kernel,{_0:false}).include(g,{_0:false}).include(c,{_0:false});if(d._0!==false)f.resolve();if(typeof b.inherited==='function')b.inherited(f);return f}});(function(){var f=function(a){var b={},c=a.prototype;for(var d in c){if(!c.hasOwnProperty(d))continue;b[d]=e.Method.create(a,d,c[d])}return b};var g=function(a,b){var c=e[a],d=e[b];c.__inc__=[];c.__dep__=[];c.__fns__=f(c);c.__tgt__=c.prototype;c.prototype.constructor=c.prototype.klass=c;e.extend(c,e.Class.prototype);c.include(d||e.Kernel);c.setName(a);c.constructor=c.klass=e.Class};g('Method');g('Module');g('Class','Module');var h=e.Kernel.instanceMethod('__eigen__');h.call(e.Method).resolve();h.call(e.Module).resolve();h.call(e.Class).include(e.Module.__meta__)})();e.NotImplementedError=new e.Class('NotImplementedError',Error);e.Method.keyword('callSuper',function(c,d,f,g){var h=d.lookup(c.name),i=h.length-1,j=e.array(g);return function(){var a=arguments.length;while(a--)j[a]=arguments[a];i-=1;var b=h[i].apply(f,j);i+=1;return b}});e.Method.keyword('blockGiven',function(a,b,c,d){var f=Array.prototype.slice.call(d,a.arity),g=(typeof f[0]==='function');return function(){return g}});e.Method.keyword('yieldWith',function(a,b,c,d){var f=Array.prototype.slice.call(d,a.arity);return function(){if(typeof f[0]!=='function')return;return f[0].apply(f[1]||null,arguments)}});e.Interface=new e.Class('Interface',{initialize:function(d){this.test=function(a,b){var c=d.length;while(c--){if(typeof a[d[c]]!=='function')return b?d[c]:false}return true}},extend:{ensure:function(){var a=e.array(arguments),b=a.shift(),c,d;while(c=a.shift()){d=c.test(b,true);if(d!==true)throw new Error('object does not implement '+d+'()');}}}});e.Singleton=new e.Class('Singleton',{initialize:function(a,b,c){return new(new e.Class(a,b,c))}});e.extend(n,e);if(o.JS)e.extend(o.JS,e)});
//@ sourceMappingURL=core.js.map