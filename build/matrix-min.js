FirminCSSMatrix=function(b){this.m11=this.m22=this.m33=this.m44=1;this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0;if(typeof b=="string"){this.setMatrixValue(b)}};FirminCSSMatrix.displayName="FirminCSSMatrix";FirminCSSMatrix.degreesToRadians=function(b){return b*Math.PI/180};FirminCSSMatrix.determinant2x2=function(b,a,c,d){return b*d-a*c};FirminCSSMatrix.determinant3x3=function(b,a,c,d,e,i,f,g,h){var j=FirminCSSMatrix.determinant2x2;return b*j(e,i,g,h)-d*j(a,c,g,h)+f*j(a,c,e,i)};FirminCSSMatrix.determinant4x4=function(b){var a=FirminCSSMatrix.determinant3x3,c=b.m11,d=b.m21,e=b.m31,i=b.m41,f=b.m12,g=b.m22,h=b.m32,j=b.m42,k=b.m13,l=b.m23,m=b.m33,n=b.m43,o=b.m14,p=b.m24,q=b.m34,r=b.m44;return c*a(g,l,p,h,m,q,j,n,r)-d*a(f,k,o,h,m,q,j,n,r)+e*a(f,k,o,g,l,p,j,n,r)-i*a(f,k,o,g,l,p,h,m,q)};FirminCSSMatrix.toMatrixString=function(f){var g={functionSignature:/(\w+)\([^\)]+\)/ig,nameAndArguments:/(\w+)\(([^\)]+)\)/i,units:/([\-\+]?[0-9]+[\.0-9]*)(deg|rad|grad|px|%)*/};var h=f.match(/(\w+)\([^\)]+\)/ig);var j=h&&h.every(function(b){return(/^matrix/).test(b)});if(!h||j)return f;var k=function(b){return b.value};var l={matrix:function(b,a){var c=new FirminCSSMatrix(a.unparsed);return b.multiply(c)},matrix3d:function(b,a){var c=new FirminCSSMatrix(a.unparsed);return b.multiply(c)},perspective:function(b,a){var c=new FirminCSSMatrix();c.m34-=1/a.value[0].value;return b.multiply(c)},rotate:function(b,a){return b.rotate.apply(b,a.value.map(k))},rotate3d:function(b,a){return b.rotateAxisAngle.apply(b,a.value.map(k))},rotateX:function(b,a){return b.rotate.apply(b,[a.value[0].value,0,0])},rotateY:function(b,a){return b.rotate.apply(b,[0,a.value[0].value,0])},rotateZ:function(b,a){return b.rotate.apply(b,[0,0,a.value[0].value])},scale:function(b,a){return b.scale.apply(b,a.value.map(k))},scale3d:function(b,a){return b.scale.apply(b,a.value.map(k))},scaleX:function(b,a){return b.scale.apply(b,a.value.map(k))},scaleY:function(b,a){return b.scale.apply(b,[0,a.value[0].value,0])},scaleZ:function(b,a){return b.scale.apply(b,[0,0,a.value[0].value])},skew:function(b,a){var c=new FirminCSSMatrix('skewX('+a.value[0].unparsed+')');var d=new FirminCSSMatrix('skewY('+a.value[1].unparsed+')');var e='matrix(1.00000, '+d.b+', '+c.c+', 1.000000, 0.000000, 0.000000)';var i=new FirminCSSMatrix(e);return b.multiply(i)},skewX:function(b,a){return b.skewX.apply(b,[a.value[0].value])},skewY:function(b,a){return b.skewY.apply(b,[a.value[0].value])},translate:function(b,a){return b.translate.apply(b,a.value.map(k))},translate3d:function(b,a){return b.translate.apply(b,a.value.map(k))},translateX:function(b,a){return b.translate.apply(b,[a.value[0].value,0,0])},translateY:function(b,a){return b.translate.apply(b,[0,a.value[0].value,0])},translateZ:function(b,a){return b.translate.apply(b,[0,0,a.value[0].value])}};var m=function(c){var d=c.match(g.nameAndArguments).slice(1);return{key:d[0],value:d[1].split(/, ?/).map(function(b){var a=b.match(g.units)||[];return{value:parseFloat(a[1]),units:a[2],unparsed:b}}),unparsed:c}};var n=h.map(m);var o=new FirminCSSMatrix();var p=n.reduce(function(a,c){c.value=c.value.map(function(b){if(b.units=='rad'){b.value=b.value*(180/Math.PI);b.units='deg'}else if(b.units=='grad'){b.value=b.value/(400/360);b.units='deg'}return b});var d=l[c.key];var e=d(a,c);return e||a},o);return p.toString()};[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(a){var c=a[0],d=a[1];Object.defineProperty(FirminCSSMatrix.prototype,d,{set:function(b){this[c]=b},get:function(){return this[c]},enumerable:true,configurable:true})});FirminCSSMatrix.prototype.isAffine=function(){return this.m13===0&&this.m14===0&&this.m23===0&&this.m24===0&&this.m31===0&&this.m32===0&&this.m33===1&&this.m34===0&&this.m43===0&&this.m44===1};FirminCSSMatrix.prototype.multiply=function(b){if(!b)return null;var a=b,c=this,d=new FirminCSSMatrix();d.m11=a.m11*c.m11+a.m12*c.m21+a.m13*c.m31+a.m14*c.m41;d.m12=a.m11*c.m12+a.m12*c.m22+a.m13*c.m32+a.m14*c.m42;d.m13=a.m11*c.m13+a.m12*c.m23+a.m13*c.m33+a.m14*c.m43;d.m14=a.m11*c.m14+a.m12*c.m24+a.m13*c.m34+a.m14*c.m44;d.m21=a.m21*c.m11+a.m22*c.m21+a.m23*c.m31+a.m24*c.m41;d.m22=a.m21*c.m12+a.m22*c.m22+a.m23*c.m32+a.m24*c.m42;d.m23=a.m21*c.m13+a.m22*c.m23+a.m23*c.m33+a.m24*c.m43;d.m24=a.m21*c.m14+a.m22*c.m24+a.m23*c.m34+a.m24*c.m44;d.m31=a.m31*c.m11+a.m32*c.m21+a.m33*c.m31+a.m34*c.m41;d.m32=a.m31*c.m12+a.m32*c.m22+a.m33*c.m32+a.m34*c.m42;d.m33=a.m31*c.m13+a.m32*c.m23+a.m33*c.m33+a.m34*c.m43;d.m34=a.m31*c.m14+a.m32*c.m24+a.m33*c.m34+a.m34*c.m44;d.m41=a.m41*c.m11+a.m42*c.m21+a.m43*c.m31+a.m44*c.m41;d.m42=a.m41*c.m12+a.m42*c.m22+a.m43*c.m32+a.m44*c.m42;d.m43=a.m41*c.m13+a.m42*c.m23+a.m43*c.m33+a.m44*c.m43;d.m44=a.m41*c.m14+a.m42*c.m24+a.m43*c.m34+a.m44*c.m44;return d};FirminCSSMatrix.prototype.isIdentityOrTranslation=function(){var b=this;return b.m11===1&&b.m12===0&&b.m13===0&&b.m14===0&&b.m21===0&&b.m22===1&&b.m23===0&&b.m24===0&&b.m31===0&&b.m31===0&&b.m33===1&&b.m34===0&&b.m44===1};FirminCSSMatrix.prototype.adjoint=function(){var b=new FirminCSSMatrix(),a=this,c=FirminCSSMatrix.determinant3x3,d=a.m11,e=a.m12,i=a.m13,f=a.m14,g=a.m21,h=a.m22,j=a.m23,k=a.m24,l=a.m31,m=a.m32,n=a.m33,o=a.m34,p=a.m41,q=a.m42,r=a.m43,s=a.m44;b.m11=c(h,m,q,j,n,r,k,o,s);b.m21=-c(g,l,p,j,n,r,k,o,s);b.m31=c(g,l,p,h,m,q,k,o,s);b.m41=-c(g,l,p,h,m,q,j,n,r);b.m12=-c(e,m,q,i,n,r,f,o,s);b.m22=c(d,l,p,i,n,r,f,o,s);b.m32=-c(d,l,p,e,m,q,f,o,s);b.m42=c(d,l,p,e,m,q,i,n,r);b.m13=c(e,h,q,i,j,r,f,k,s);b.m23=-c(d,g,p,i,j,r,f,k,s);b.m33=c(d,g,p,e,h,q,f,k,s);b.m43=-c(d,g,p,e,h,q,i,j,r);b.m14=-c(e,h,m,i,j,n,f,k,o);b.m24=c(d,g,l,i,j,n,f,k,o);b.m34=-c(d,g,l,e,h,m,f,k,o);b.m44=c(d,g,l,e,h,m,i,j,n);return b};FirminCSSMatrix.prototype.inverse=function(){var b,a,c,d,e;if(this.isIdentityOrTranslation()){b=new FirminCSSMatrix();if(!(this.m41===0&&this.m42===0&&this.m43===0)){b.m41=-this.m41;b.m42=-this.m42;b.m43=-this.m43}return b}c=this.adjoint();a=FirminCSSMatrix.determinant4x4(this);if(Math.abs(a)<1e-8)return null;for(d=1;d<5;d++){for(e=1;e<5;e++){c[("m"+d)+e]/=a}}return c};FirminCSSMatrix.prototype.rotate=function(b,a,c){var d=FirminCSSMatrix.degreesToRadians;if(typeof b!="number"||isNaN(b))b=0;if((typeof a!="number"||isNaN(a))&&(typeof c!="number"||isNaN(c))){c=b;b=0;a=0}if(typeof a!="number"||isNaN(a))a=0;if(typeof c!="number"||isNaN(c))c=0;b=d(b);a=d(a);c=d(c);var e=new FirminCSSMatrix(),i=new FirminCSSMatrix(),f=new FirminCSSMatrix(),g,h,j;c/=2;g=Math.sin(c);h=Math.cos(c);j=g*g;f.m11=f.m22=1-2*j;f.m12=f.m21=2*g*h;f.m21*=-1;a/=2;g=Math.sin(a);h=Math.cos(a);j=g*g;i.m11=i.m33=1-2*j;i.m13=i.m31=2*g*h;i.m13*=-1;b/=2;g=Math.sin(b);h=Math.cos(b);j=g*g;e.m22=e.m33=1-2*j;e.m23=e.m32=2*g*h;e.m32*=-1;var k=(this.toString()===(new FirminCSSMatrix).toString());return(k)?f.multiply(i).multiply(e):this.multiply(e).multiply(i).multiply(f)};FirminCSSMatrix.prototype.rotateAxisAngle=function(b,a,c,d){if(typeof b!="number"||isNaN(b))b=0;if(typeof a!="number"||isNaN(a))a=0;if(typeof c!="number"||isNaN(c))c=0;if(typeof d!="number"||isNaN(d))d=0;if(b===0&&a===0&&c===0)c=1;var e=new FirminCSSMatrix(),i=Math.sqrt(b*b+a*a+c*c),f,g,h,j,k,l,m;d=(FirminCSSMatrix.degreesToRadians(d)||0)/2;f=Math.cos(d);g=Math.sin(d);h=g*g;if(i===0){b=0;a=0;c=1}else if(i!==1){b/=i;a/=i;c/=i}if(b===1&&a===0&&c===0){e.m22=e.m33=1-2*h;e.m23=e.m32=2*f*g;e.m32*=-1}else if(b===0&&a===1&&c===0){e.m11=e.m33=1-2*h;e.m13=e.m31=2*f*g;e.m13*=-1}else if(b===0&&a===0&&c===1){e.m11=e.m22=1-2*h;e.m12=e.m21=2*f*g;e.m21*=-1}else{j=g*f;k=b*b;l=a*a;m=c*c;e.m11=1-2*(l+m)*h;e.m12=2*(b*a*h+c*j);e.m13=2*(b*c*h-a*j);e.m21=2*(a*b*h-c*j);e.m22=1-2*(m+k)*h;e.m23=2*(a*c*h+b*j);e.m31=2*(c*b*h+a*j);e.m32=2*(c*a*h-b*j);e.m33=1-2*(k+l)*h}return this.multiply(e)};FirminCSSMatrix.prototype.scale=function(b,a,c){var d=new FirminCSSMatrix();if(typeof b!="number"||isNaN(b))b=1;if(typeof a!="number"||isNaN(a))a=b;if(typeof c!="number"||isNaN(c))c=1;d.m11=b;d.m22=a;d.m33=c;return this.multiply(d)};FirminCSSMatrix.prototype.skewX=function(b){var a=FirminCSSMatrix.degreesToRadians(b);var c=new FirminCSSMatrix();c.c=Math.tan(a);return this.multiply(c)};FirminCSSMatrix.prototype.skewY=function(b){var a=FirminCSSMatrix.degreesToRadians(b);var c=new FirminCSSMatrix();c.b=Math.tan(a);return this.multiply(c)};FirminCSSMatrix.prototype.translate=function(b,a,c){var d=new FirminCSSMatrix();if(typeof b!="number"||isNaN(b))b=0;if(typeof a!="number"||isNaN(a))a=0;if(typeof c!="number"||isNaN(c))c=0;d.m41=b;d.m42=a;d.m43=c;return this.multiply(d)};FirminCSSMatrix.prototype.setMatrixValue=function(b){b=FirminCSSMatrix.toMatrixString(b.trim());var a=b.match(/^matrix(3d)?\(\s*(.+)\s*\)$/),c,d,e,i,f,g;if(!a)return;c=!!a[1];d=a[2].split(/\s*,\s*/);e=d.length;i=new Array(e);if((c&&e!==16)||!(c||e===6))return;for(f=0;f<e;f++){g=d[f];if(g.match(/^-?\d+(\.\d+)?$/)){i[f]=parseFloat(g)}else return}for(f=0;f<e;f++){point=c?("m"+(Math.floor(f/4)+1))+(f%4+1):String.fromCharCode(f+97);this[point]=i[f]}};FirminCSSMatrix.prototype.toString=function(){var a=this,c,d;if(this.isAffine()){d="matrix(";c=["a","b","c","d","e","f"]}else{d="matrix3d(";c=["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"]}return d+c.map(function(b){return a[b].toFixed(6)}).join(", ")+")"};